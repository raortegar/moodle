define("tiny_aiplacement/generatebase",["exports","tiny_aiplacement/loading","core/str","core/templates","tiny_aiplacement/options","core/ai/policy"],(function(_exports,_loading,_str,_templates,_options,_policy){var obj;function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_templates=(obj=_templates)&&obj.__esModule?obj:{default:obj};return _exports.default=class{constructor(editor){var _this=this;_defineProperty(this,"modalObject",void 0),_defineProperty(this,"displayContentModal",(async()=>{const templateContext=this.getTemplateContext();this.modalObject=await this.setupModal(),await this.modalObject.show();(await(0,_policy.getPolicyStatus)(this.userid,this.contextid)).status?await this.setupContentModal(templateContext):await this.setupPolicyModal(templateContext)})),_defineProperty(this,"addContentEventListeners",(async()=>{const root=(await this.modalObject.getRoot())[0];root.addEventListener("click",(e=>{this.handleContentModalClick(e,root)})),this.setupPromptArea(root),this.hideLoadingSpinner(root)})),_defineProperty(this,"setupPolicyModal",(async templateContext=>{const loadingContext={...templateContext,ishidden:!0},[loadingBody,policyBody,policyFooter]=await Promise.all([_templates.default.render("tiny_aiplacement/loading",loadingContext),_templates.default.render("tiny_aiplacement/modalbodypolicy",templateContext),_templates.default.render("tiny_aiplacement/modalfooterpolicy",templateContext)]);this.modalObject.setBody(loadingBody+policyBody),this.modalObject.setFooter(policyFooter),this.modalObject.setTitle((0,_str.getString)("aiusagepolicy","core_ai")),this.addPolicyEventListeners()})),_defineProperty(this,"hideLoadingSpinner",(root=>{const loadingSpinnerDiv=root.querySelector("#".concat(this.editor.id,"_tiny_aiplacement_spinner"));loadingSpinnerDiv.classList.add("hidden"),loadingSpinnerDiv.classList.remove("tiny-aiplacement-loading-spinner-container")})),_defineProperty(this,"addPolicyEventListeners",(async()=>{(await this.modalObject.getRoot())[0].addEventListener("click",(e=>{this.handlePolicyModalClick(e)}))})),_defineProperty(this,"handlePolicyModalClick",(e=>{const actions={accept:()=>this.handlePolicyAccept(e.target),cancel:()=>this.modalObject.destroy()},actionKey=Object.keys(actions).find((key=>e.target.closest('[data-action="'.concat(key,'"]'))));actionKey&&(e.preventDefault(),actions[actionKey]())})),_defineProperty(this,"handlePolicyAccept",(async acceptBtn=>{await(0,_policy.setPolicyStatus)(this.userid,this.contextid);const root=(await this.modalObject.getRoot())[0];await this.displayLoading(root,acceptBtn,"tiny-aiplacement-loading-spinner-container");const templateContext=this.getTemplateContext();await this.setupContentModal(templateContext),await this.hideLoading(root,acceptBtn)})),_defineProperty(this,"getTemplateContext",(()=>({elementid:this.editor.id}))),_defineProperty(this,"displayLoading",(async function(root,submitBtn){let removeClass=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const loadingSpinnerDiv=root.querySelector("#".concat(_this.editor.id,"_tiny_aiplacement_spinner")),overlayDiv=root.querySelector("#".concat(_this.editor.id,"_tiny_aiplacement_overlay")),blurDiv=root.querySelector("#".concat(_this.editor.id,"_tiny_aiplacement_blur")),loadingTextDiv=root.querySelector("#".concat(_this.editor.id,"_tiny_aiplacement_loading_text")),actionButtons=root.querySelectorAll(".tiny-aiplacement-generate-footer button");(0,_loading.loadingMessages)(loadingTextDiv),removeClass&&loadingSpinnerDiv.classList.remove(removeClass),loadingSpinnerDiv.classList.remove("hidden"),overlayDiv.classList.remove("hidden"),blurDiv.classList.add("tiny-aiplacement-blur"),submitBtn.innerHTML=await(0,_str.getString)("generating","tiny_aiplacement"),actionButtons&&actionButtons.forEach((button=>{button.disabled=!0}))})),_defineProperty(this,"hideLoading",(async(root,submitBtn)=>{const loadingSpinnerDiv=root.querySelector("#".concat(this.editor.id,"_tiny_aiplacement_spinner")),overlayDiv=root.querySelector("#".concat(this.editor.id,"_tiny_aiplacement_overlay")),blurDiv=root.querySelector("#".concat(this.editor.id,"_tiny_aiplacement_blur")),actionButtons=root.querySelectorAll(".tiny-aiplacement-generate-footer button");loadingSpinnerDiv&&loadingSpinnerDiv.classList.add("hidden"),overlayDiv&&overlayDiv.classList.add("hidden"),blurDiv&&blurDiv.classList.remove("tiny-aiplacement-blur"),submitBtn.innerHTML=await(0,_str.getString)("regenerate","tiny_aiplacement"),actionButtons&&actionButtons.forEach((button=>{button.disabled=!1}))})),this.editor=editor,this.userid=(0,_options.getUserId)(editor),this.contextid=(0,_options.getContextId)(editor),this.responseObj=null}},_exports.default}));

//# sourceMappingURL=generatebase.min.js.map